---
sidebar_position: 2
---
## 定位简介

定位是导航中的重要实现之一，所谓定位，就是参考某个坐标系(比如:以机器人的出发点为原点创建坐标系)在该坐标系中标注机器人。定位原理看似简单，但是这个这个坐标系不是客观存在的，我们也无法以上帝视角确定机器人的位姿，定位实现需要依赖于机器人自身，机器人需要逆向推导参考系原点并计算坐标系相对关系，该过程实现常用方式有两种:

- 通过里程计定位:时时收集机器人的速度信息计算并发布机器人坐标系与父级参考系的相对关系。
- 通过传感器定位:通过传感器收集外界环境信息通过匹配计算并发布机器人坐标系与父级参考系的相对关系。

两种发方式在导航中都会经常使用。

## 特点

两中定位方式都有各自的优缺点。

里程计定位：

- 优：定位信息连续，无离散的跳跃；
- 缺：存在累计误差，不利于长距或长期定位；

传感器定位:

- 优：比里程计定位更精准；
- 缺：会出现跳变情况，且传感器定位在标志物较少的环境下，其定位精度会大大下降；

## 自适应蒙特卡罗定位（AMCL）简介

AMCL(adaptive Monte Carlo Localization) 是用于2D移动机器人的概率定位系统，它实现了自适应（或KLD采样）蒙特卡洛定位方法，可以根据已有地图使用粒子滤波器推算机器人位置。

蒙特卡罗”这个名字是出自摩纳哥的蒙特卡罗赌场，这个方法是一类基于概率的方法的统称，不是特指一种方法。它的原理就是不断抽样不断逼近来求解。例如我们在一个正方形中有一个不规则的形状想求它的面积，那么我可以在这个正方形中均匀地打上点，然后统计落在不规则形状中的点（例如颜色是白色的）的数量与总点数的比值，因为正方形的面积好计算所以就能计算出不规则形状的面积。但是点越密集越接近真实结果。

粒子滤波是指我们用撒粒子的方式以蒙特卡罗的思想来计算机器人在地图中的位置。每次撒完粒子我们通过里程计计算和激光数据比较得到每一个粒子接近正确位置的概率值，如果概率高就给这个粒子高分，下次就在这个位置多撒点粒子，迭代几次粒子就会聚集在概率高的位置周围，从而获得机器人最终的定位。

AMCL算法中使用KLD采样优化粒子滤波的计算效率，因为如果每次都使用大量的粒子是比较低效的，一旦机器人确定了自己的位置之后只需要一小部分粒子就足以跟踪机器人的位置，它可以根据时间自适应的调整粒子数量。KLD的全称是库尔贝克-莱布勒散度Kullback-Leibler Divergence，它是一种计算两个概率分布之间差异的方法。KLD采样背后的思想就是根据基于采样近似质量的统计界限来确定粒子数量。

如何计算每个粒子的概率呢？首先我们在地图上布满粒子，每个粒子的朝向是随机的。然后按照机器人的运动方向给粒子一个运动量，比如向前移动1cm，然后将粒子模拟的传感器数据（如当前粒子位置发出的激光应该看到什么结果）与观测到的激光和地图对比，如果数据和地图或激光观测的障碍匹配度越高就给这个粒子较高的概率值，那么下一次撒粒子的时候就会在概率高的粒子处撒更多的粒子。这样粒子就会迭代收敛，最后确定出机器人的位置。

## 坐标变换

里程计本身也是可以协助机器人定位的，不过里程计存在累计误差且一些特殊情况时(车轮打滑)会出现定位错误的情况，amcl 则可以通过估算机器人在地图坐标系下的姿态，再结合里程计提高定位准确度

- 里程计定位:只是通过里程计数据实现 `/odom_frame` 与 `/base_frame` 之间的坐标变换。
- amcl定位: 可以提供 `/map_frame` 、`/odom_frame` 与 `/base_frame` 之间的坐标变换。

![请添加图片描述](https://img-blog.csdnimg.cn/24e07f2b946344ab8b58abc460a53b4d.png)

## 参考致谢

- [自适应蒙特卡罗定位（AMCL）原理](https://kknews.cc/tech/43nlegx.html)
