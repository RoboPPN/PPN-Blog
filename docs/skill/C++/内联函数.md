## 为什么要使用内联函数的原因

函数调用时，需要建立栈空间来保存调用时的现场状态和返回地址，并且进行参数传送，产生程序转移。系统完成这些工作都需要时间和空间方面的开销。因此，C++提供内联函数机制，定义一些功能比较简单、代码比较短的函数。编译时，系统把内联函数的函数体嵌入到每个函数调用处，节省了程序运行时的调用开销。

引入内联函数的目的是为了解决程序中函数调用的效率问题，这么说吧，程序在编译器编译的时候，编译器将程序中出现的内联函数的调用表达式用内联函数的函数体进行替换，而对于其他的函数，都是在运行时候才被替代。这其实就是个用空间代价换取时间的节省。所以内联函数一般都是1-5行的小函数。在使用内联函数时要留神：

- 在内联函数内不允许使用循环语句和开关语句；
- 内联函数的定义必须出现在内联函数第一次调用之前；
- 在类定义中的定义的函数都是内联函数，即使没有使用 inline 说明符;

定义: 当函数被声明为内联函数之后, 编译器会将其内联展开, 而不是按通常的函数调用机制进行调用。

优点: 当函数体比较小的时候, 内联该函数可以令目标代码更加高效. 对于存取函数以及其它函数体比较短, 性能关键的函数, 鼓励使用内联。

缺点: 滥用内联将导致程序变慢. 内联可能使目标代码量或增或减, 这取决于内联函数的大小。 内联非常短小的存取函数通常会减少代码大小, 但内联一个相当大的函数将戏剧性的增加代码大小。 现代处理器由于更好的利用了指令缓存, 小巧的代码往往执行更快。

结论: 一个较为合理的经验准则是, 不要内联超过 10 行的函数。 谨慎对待析构函数, 析构函数往往比其表面看起来要更长, 因为有隐含的成员和基类析构函数被调用!

另一个实用的经验准则: 内联那些包含循环或 switch 语句的函数常常是得不偿失 (除非在大多数情况下, 这些循环或 switch 语句从不被执行)。

有些函数即使声明为内联的也不一定会被编译器内联, 这点很重要; 比如虚函数和递归函数就不会被正常内联。 通常, 递归函数不应该声明成内联函数。(递归调用堆栈的展开并不像循环那么简单, 比如递归层数在编译时可能是未知的, 大多数编译器都不支持内联递归函数)。 虚函数内联的主要原因则是想把它的函数体放在类定义内, 为了图个方便, 抑或是当作文档描述其行为, 比如精短的存取函数。

**内联函数主要有两个作用:1. 消除函数调用时的开销 2. 取代参数的宏**

1. 我认为将内联函数作为带参宏的替代方案更为靠谱,而不是真的当做函数使用。  
2. 在多文件编程时,我建议将内联函数的定义直接放在头文件中,并且禁用内联函数的声明(声明是多此一举)  ---by 严长生

## 定义内联函数的方法是

在函数名第一次出现的时，在函数名之前加上关键字inline。通常在函数原型中指定inline。若已在函数原型中指定inline，则函数定义时不能重复给出。

**内联函数原型为：**  

```cpp
inline 类型 函数名 （形式参数表）；
```

> 内联函数的调用方法与其他普通函数相同。

```cpp
#include <iostream>
using namespace std;

inline int The_max_count(int a,int b,int c);

int main()
{
    int a,b,c;
    cin>>a>>b>>c;
    cout<<The_max_count(a,b,c)<<endl;
    return 0;

}

int The_max_count(int a,int b,int c)
{
    int max;
    max=a>b?a>c?a:c:b>c?b:c;
    return max;
}
```

## 对内敛函数的使用需要说明如下3点

- 若inline不在函数名第一次出现时指定，则编译器把它作为普通函数处理。
例如，上面代码的The_max_count函数写成：

```cpp
int The_max_count(int a,int b,int c)；
// -----------------------------------------------------
 inline int The_max_count(int a,int b,int c)
 {
    int max;
    max=a>b?a>c?a:c:b>c?b:c;
    return max;
}
```

   则The_max_count函数是普通函数，编译器不作嵌入处理。

- 一般内联函数只适用于1~5行的小程序。在内联函数中，不能含有复杂的流程控制语句。例如，不能含有多分支语句和循环语句，否则，inline无效;
- 递归函数不能说明为内联函数;

## 内联函数替换带参数的宏

```cpp
inline double sq(double Y)
{
    return Y*Y;
}
```

墙裂推荐使用内联函数代替带参数的宏。
